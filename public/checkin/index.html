<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <img src="" id="weatherImg" class="img-fluid" alt="Responsive weather image">
    <div class="container">
        <div class="row justify-content-end">
            <img src="./assets/my_location-24px.svg" width="20" height="20" class="d-inline-block align-top" alt="my-location">
            <h6 class="card-text text-right">  Latitude: <span id="lat"></span>째
                Longitude: <span id="lon"></span>째
            </h6>
        </div>
        <h3 class="card-text">The weather is <span id="summary"></span></h3>
        <div class="row">
            <div class="col">
                <div class="card-group">
                    <div class="card" style="width: 18rem;">
                        <div class="card-body">
                            <h5 class="card-title">Temperature</h5>
                            <h1 class="card-text"><span id="temperature"></span>째C</h1>
                        </div>
                    </div>  
                    <div class="card" style="width: 18rem;">
                        <div class="card-body">
                            <h5 class="card-title">Feels like</h5>
                            <h1 class="card-text"><span id="apparentTemperature"></span>째C</h1>
                        </div>
                    </div>
                    <div class="card" style="width: 18rem;">
                        <div class="card-body">
                            <h4 class="card-text">Rain: <span id="precipIntensity"></span>%</h4>
                            <h4 class="card-text">Humidity: <span id="humidity"></span>%</h4>
                            <h4 class="card-text">Wind: <span id="windSpeed"></span>Km/h</h4>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Air Quality</h5>
                        <h5 class="card-text"><span id="sourceName"></span></h5>
                        <h6 class="card-text">The concentration of particulate matter (<span id="aq_parameter"></span>)
                            is <span id="aq_value"></span> <span id="aq_units"></span> last read on <span id="aq_date"></span>
                        </h6>
                    </div>
                </div> 
            </div>
        </div>
    </div>
    <script>
        // Ensure geolocation availability
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(async function (position) {
                let lat, lon, weather, air_quality
                // Reading geolocation from browser
                lat = position.coords.latitude
                lon = position.coords.longitude
                // Return geolocation to user view
                document.getElementById('lat').textContent = lat.toFixed(5)
                document.getElementById('lon').textContent = lon.toFixed(5)
                // fetch api
                const api_url = `weather/${lat},${lon}`
                const weatherAndAirQuality_response = await fetch(api_url)
                const weatherAndAirQuality_data = await weatherAndAirQuality_response.json()
                // Temperature information
                weather = weatherAndAirQuality_data.weather.currently
                const img_url = `./assets/weather/${weather.icon}.jpg`
                document.getElementById('weatherImg').src = img_url
                document.getElementById('summary').textContent = weather.summary
                document.getElementById('temperature').textContent = weather.temperature
                document.getElementById('apparentTemperature').textContent = weather.apparentTemperature
                document.getElementById('humidity').textContent = weather.humidity
                document.getElementById('windSpeed').textContent = weather.windSpeed
                document.getElementById('precipIntensity').textContent = weather.precipIntensity
                // Air quality information
                air_quality = weatherAndAirQuality_data.air_quality.results[0].measurements[2]
                document.getElementById('aq_parameter').textContent = air_quality.parameter
                document.getElementById('aq_value').textContent = air_quality.value
                document.getElementById('aq_units').textContent = air_quality.unit
                document.getElementById('aq_date').textContent = air_quality.lastUpdated.toLocaleString()
                document.getElementById('sourceName').textContent = air_quality.sourceName

                console.log(weatherAndAirQuality_data)
            })
        } else {
            alert("I'm sorry, but geolocation services are not supported by your browser.")
        }
    </script>
</body>
</html>